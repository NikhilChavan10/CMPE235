var ScanditSDKProxy=function(){function e(){var e=Windows.Graphics.Display,n=e.DisplayInformation.getForCurrentView().currentOrientation;return n===e.DisplayOrientations.portrait||n===e.DisplayOrientations.portraitFlipped}function n(n){var t=n.viewfinderDimension;return e()?{width:t[0],height:t[1]}:{width:t[2],height:t[3]}}function t(n){return e()?n.portraitMargins:n.landscapeMargins}function i(e){var n=JSON.stringify(e),t=new BarcodeScannerPlugin.ScanSettingsProxy(n),i=e.scanningHotSpot;t.setScanningHotSpot(i.x,i.y);var r=e.activeScanningAreaPortrait;t.setActiveScanningAreaPortrait(r.x,r.y,r.width,r.height);var o=e.activeScanningAreaLandscape;return t.setActiveScanningAreaLandscape(o.x,o.y,o.width,o.height),t.setCameraFacing(e.cameraFacingPreference),t}function r(e,n,t){if(void 0!==e.endsWith&&e.endsWith("%")){var i=.01*parseFloat(e.substr(0,e.length-1));return i*t}return parseFloat(e)*n}function o(e){var n=Windows.Graphics.Display.DisplayInformation.getForCurrentView(),t=n.rawDpiX/n.logicalDpi,i=n.rawDpiY/n.logicalDpi;return{left:r(e[0],t,window.innerWidth),right:r(e[2],t,window.innerWidth),top:r(e[1],i,window.innerHeight),bottom:r(e[3],i,window.innerHeight)}}function a(e,n){var t=o(n);e.style.margin=t.top+"px "+t.right+"px "+t.bottom+"px "+t.left+"px";var i=window.innerWidth,r=window.innerHeight;e.style.width=i-t.left-t.right+"px",e.style.height=r-t.top-t.bottom+"px"}function l(){var e={beep:!0,viewfinderColor:"#fff",viewfinderDecodedColor:"#fff",guiStyle:Scandit.ScanOverlay.GuiStyle.DEFAULT,viewfinderDimension:[.9,.4,.6,.4]};return e}function c(e,n){for(var t in e)e.hasOwnProperty(t)&&"function"!=typeof e[t]&&"picker"!==t&&"properties"!==t&&(n[t]=e[t])}function s(e,n,t,i,r){var a=o(e),l=window.innerWidth-a.left-a.right,c=window.innerHeight-a.top-a.bottom,s=(n.y-.5*t.height)*c,d=(n.x-.5*t.width)*l,p=t.width*l,u=t.height*c;i.style.top=s+"px",i.style.left=d+"px",i.style.width=p+"px",i.style.height=u+"px",r.style.top=s+u+"px",i.style.display=M.overlay.guiStyle==Scandit.ScanOverlay.GuiStyle.NONE?"none":"block",i.style.borderColor=M.overlay.viewfinderColor;var y=55;r.style.left=d+p-y+"px"}function d(n){if(null!=n.capture){var t=n.capture.videoWidth,i=n.capture.videoHeight;if(0!==t&&0!==i){if(e()){var r=t;t=i,i=r}var o,a,l=t/i,c=n.root.clientWidth/n.root.clientHeight;c>l?(o=n.root.clientWidth,a=Math.round(o/l)):(a=Math.round(n.root.clientHeight),o=a*l);var s=Math.floor((n.root.clientHeight-a)/2)+"px",d=Math.floor((n.root.clientWidth-o)/2)+"px";setTimeout(function(){n.preview&&(n.preview.style.width=o+"px",n.preview.style.height=a+"px",n.preview.style.margin=s+" "+d)},50),setTimeout(function(){n.preview&&(n.preview.style.height=a+.5+"px")},1e3)}}}function p(){P()}function u(){M.preview&&("hidden"===document.visibilityState&&M.running?(M.startOnWindowVisible=!0,h()):M.startOnWindowVisible&&(S({paused:M.paused}),M.startOnWindowVisible=!1))}function y(e){if(null!=M.capture){M.errorPanel.style.display="table",M.errorPanel.style.width=M.root.style.width,M.errorPanel.style.height=M.root.style.height,M.errorPanel.style.fontSize="160%";var n="display:table-cell;text-align:center;text-transform:none;vertical-align:middle;opacity:1.0;padding:50px";M.errorPanel.innerHTML='<div style="'+n+'">'+e+"</div>",M.viewFinder.style.display="none",M.logo.style.display="none"}}function v(){return-1!==navigator.appVersion.indexOf("MSAppHost/3.0")?!1:-1!==navigator.appVersion.indexOf("Windows Phone 8.1;")?!1:-1!==navigator.appVersion.indexOf("MSAppHost/2.0;")?!0:!1}function g(e){var n=999;if(e.root=document.createElement("div"),e.root.style.position="absolute",e.root.style.margin="0px",e.root.style.background="black",e.root.style.overflow="hidden",e.root.style.top="0px",e.root.style.left="0px",e.root.style.zIndex=n,e.errorPanel=document.createElement("div"),e.errorPanel.style.position="absolute",e.errorPanel.style.margin="0px",e.errorPanel.style.background="black",e.errorPanel.style.color="white",e.errorPanel.style.textAlign="center",e.errorPanel.style.verticalAlign="middle",e.errorPanel.style.opacity=.7,e.errorPanel.style.display="none",e.errorPanel.style.zIndex=n+1,e.errorPanel.style.padding="0px",e.errorPanel.innertHTML="One, two, three",e.root.appendChild(e.errorPanel),document.body.appendChild(e.root),e.preview=document.createElement("video"),e.preview.msZoom=!0,e.preview.style.background="black",e.preview.style.zIndex=n+1,e.root.appendChild(e.preview),e.logo=document.createElement("img"),e.logo.src="/www/img/scandit-logo.svg",e.logo.style.width="55px",e.logo.style.height="20px",e.logo.style.position="absolute",e.logo.style.zIndex=n+2,e.logo.msUserSelect="none",e.root.appendChild(e.logo),e.viewFinder=document.createElement("div"),e.viewFinder.style.zIndex=n+2,e.viewFinder.style.position="absolute",e.viewFinder.style.borderWidth="1px",e.viewFinder.style.borderStyle="solid",e.viewFinder.style.borderRadius="10px",e.root.appendChild(e.viewFinder),v()&&e.isFullScreen){var t=document.createElement("div");t.style.width="100%",t.style.background="black",t.style.opacity=.4,t.style.zIndex=n+2,t.style.color="white",t.style.color="white",t.style.fontSize="200%",t.style.textTransform="none",t.style.bottom="0px",t.style.left="0px",t.style.padding="5px",t.style.position="absolute",t.style.msUserSelect="none";var i=document.createElement("span");i.onclick=F,i.innerHTML="Cancel",t.appendChild(i),i.style.opacity=1,e.root.appendChild(t)}else t=null;e.beeper=document.createElement("audio");var r=document.createElement("source");r.src="/www/wav/scan-beep.wav",e.beeper.appendChild(r)}function w(e,r,o,w,h){M.scanSettings=o,M.overlay=l(),c(h,M.overlay),M.isFullScreen=!w.landscapeMargins&&!w.portraitMargins,g(M),M.continuousMode=w.continuousMode,M.cancelCallback=r;var m=i(o);M.margins={landscapeMargins:w.landscapeMargins||[0,0,0,0],portraitMargins:w.portraitMargins||[0,0,0,0]};var b=t(M.margins);a(M.root,b);var x=n(M.overlay);s(b,o.scanningHotSpot,x,M.viewFinder,M.logo),document.addEventListener("visibilitychange",u),window.addEventListener("resize",p),M.isFullScreen&&!v()&&document.addEventListener("backbutton",F,!1),M.capture=new BarcodeScannerPlugin.Capture(m),null!==e&&M.capture.addDidScanDelegate(function(n){M.overlay.beep&&M.beeper.play(),e(n.session,{keepCallback:M.continuousMode}),M.continuousMode||f(),n.done()}),null!==M.cancelCallback&&M.capture.addFailDelegate(function(e){M.cancelCallback(e)}),M.capture.addOrientationChangedCallback(function(){M.capture&&d(M)}),M.capture.addRecognitionFailedDelegate(y)}function h(){M.preview.pause();var e=M.capture;return e.stopAsync().then(function(){return M.preview.src=null,e.closeAsync()})}function f(){if(null!=M.capture){M.running=!1;var e=M.root;h().then(function(){e&&document.body.removeChild(e),document.removeEventListener("visibilitychange",u),document.removeEventListener("backbutton",F),window.removeEventListener("resize",p),M.preview=null,M.capture=null,M.settings=null,M.margins=null,M.root=null,M.beeper=null,M.otherElements=null})}}function m(){M.capture&&(M.paused=!0,M.capture.pauseAsync())}function b(){M.capture&&(M.paused=!1,M.capture.resumeAsync())}function x(){M.capture&&M.preview&&(M.preview.removeEventListener("loadeddata",x),M.capture.startAsync(M.paused).then(function(){d(M)}))}function S(e){M.capture&&(M.running=!0,M.capture.initAsync().then(function(){M.capture&&(M.preview.src=URL.createObjectURL(M.capture.mediaCaptureSource),M.paused=e.paused,M.preview.addEventListener("loadeddata",x),M.preview.play())}))}function C(e){M.capture&&(M.margins=e,P())}function P(){if(null!==M.preview){var e=t(M.margins);a(M.root,e);var i=n(M.overlay);s(e,M.scanSettings.scanningHotSpot,i,M.viewFinder,M.logo),d(M)}}function F(){M.capture&&(M.cancelCallback&&M.cancelCallback("Canceled",{keepCallback:!0}),f())}function k(e){if(M.capture){var n=i(e);M.capture.applySettingsAsync(n)}}var M={root:null,preview:null,capture:null,settings:null,scanSettings:null,margins:null,deviceOrientationChangeListener:null,continuousMode:!1,cancelCallback:null,paused:!1,running:!1,startOnWindowVisible:!1};return{show:function(e,n,t){w(e,n,t[0],t[1],t[2])},cancel:function(){F()},start:function(e,n,t){S(t[0])},initLicense:function(e,n,t){BarcodeScannerPlugin.Capture.appKey=t[0]},applySettings:function(e,n,t){k(t[0])},stop:function(){m(),h()},pause:function(){m()},resume:function(){b()},torch:function(){},updateOverlay:function(e,i,r){c(r[0],M.overlay);var o=n(M.overlay);s(t(M.margins),M.scanSettings.scanningHotSpot,o,M.viewFinder,M.logo)},resize:function(e,n,t){M.isFullScreen||C(t[0])}}}();cordova.commandProxy.add("ScanditSDK",ScanditSDKProxy);